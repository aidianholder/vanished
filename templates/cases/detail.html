{% extends "base.html" %}

{% block main_content %}
        <div class="container">
            <div class="row">
                <div class="col s12 col l8 offset-l2">
                    <div class="card-panel">
                        {% if victim %}
                            <h6>{{ victim.classification }}</h6>
                            <h1 class="victim_name">{{ victim.first_name }} {% if victim.middle_name %}{{ victim.middle_name }}{% endif %} {{ victim.last_name }}</h1>

                            {%  if victim.photo %}
                                <img class="responsive-img" src="{{ victim.photo.url }}"/>
                            {% endif %}

                            <div class="row missing">
                                {% if victim.missing_since %}
                                <div class="col s6">
                                    <p>Vanished:<br/> {{ victim.missing_since }}</p>
                                </div>
                                {% endif %}
                                {% if victim.missing_from %}
                                <div class="col s6">
                                    <p>Vanished From:<br/> {{ victim.missing_from }}</p>
                                </div>
                                {% endif %}
                            </div>

                            {% if victim.narrative %}
                                <h5>Narrative</h5>
                                <p>{{ victim.narrative }}</p>
                            {% endif %}

                            {% if victim.description %}<div class="divider"></div>
                                <h5>Description</h5>
                                <p>{{ victim.description }}</p>
                            {%  endif %}

                            {% if victim.enrolled == "True" %}
                                <p>Member of {{ victim.tribe }}</p>
                            {% endif %}

                            {% if victim.agency %}<div class="divider"></div>
                                <h5>Responsible Agency</h5>
                                <p>{{ victim.agency }}</p>
                            {% endif %}

                        {% endif %}



                    </div>


                </div>
            </div>
        {% if articles %}
        <div class="row">
                <div class="col s12 col l8 offset-l2">
                    <div class="card-panel">
                    <h5>Related Stories</h5>
                        <ul>
                        {%  for article in articles %}
                            <li><a class='related_story' href="{{ article.url }}">{{ article.hed }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>


            </div>
        </div>
        {% endif %}
    </div>
{% if markers %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/mapbox-gl/1.0.0/mapbox-gl.js"></script>
<!--<script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.45.0/mapbox-gl.js"></script>-->
<link href="https://cdnjs.cloudflare.com/ajax/libs/mapbox-gl/1.0.0/mapbox-gl.css" rel="stylesheet">

    <style>
        body { margin:0; padding:0; }
        #map {width:100%; height: 480px; }
         .mapboxgl-popup {
            max-width: 10rem;
            font: 10px/16px 'Helvetica Neue', Arial, sans-serif;
         }
    </style>

    <div id="map" class="mapboxgl-js"></div>

    <script>

    let bounds = [[-124.438, 45.375][-116.563, 49.24]];
    let map;
    map = new mapboxgl.Map({
        container: 'map',
        style: 'https://aidianholder.com/mapserver/osm-liberty.json',
        center: ["{{ markers.0.lon }}", "{{ markers.0.lat }}"],
        zoom: 7

    });

    map.on('load', function () {
        map.addSource('Yakama', {
		'type': 'geojson',
		'data': {
			'type': 'Feature',
			'geometry': {
				'type': 'Polygon',
				'coordinates': [
					[
						[ -121.083062325527635, 45.990859657361234 ], 
						[ -121.15717033611385, 45.983981648789417 ], 
						[ -121.197399344239187, 45.986668644617048 ], 
						[ -121.253443346460074, 45.957285637689239 ], 
						[ -121.26944934640342, 45.944652635077652 ], 
						[ -121.281969349426532, 45.94976663445668 ], [ -121.312398348791177, 45.922864629157729 ], [ -121.334904350904807, 45.917318626547633 ], [ -121.3925803545675, 45.887022618930793 ], [ -121.402498355585792, 45.886700617311945 ], [ -121.452064369631231, 45.910339613851406 ], [ -121.452483377709953, 45.952149616794955 ], [ -121.442046383049544, 45.982627619618647 ], [ -121.416486384488962, 46.012793624208889 ], [ -121.423265394893619, 46.053879625477833 ], [ -121.436080400196062, 46.071421625483694 ], [ -121.428324404672395, 46.092557627217019 ], [ -121.440624411254248, 46.117066627706954 ], [ -121.48209743170294, 46.181543627446445 ], [ -121.490441438690766, 46.207033627645252 ], [ -121.463204437780533, 46.225189631682518 ], [ -121.462472441938999, 46.239653632934655 ], [ -121.478562448787244, 46.262526632567962 ], [ -121.474616453949707, 46.288656634261173 ], [ -121.519402474690708, 46.349598633083865 ], [ -121.495379478585917, 46.384970638126056 ], [ -121.466017476071741, 46.395797641408258 ], [ -121.458988473874456, 46.389939642336749 ], [ -121.394984462745668, 46.389317649019176 ], [ -121.386571465776029, 46.41060665120925 ], [ -121.407774474778577, 46.430933650452509 ], [ -121.411992480951966, 46.459534651462086 ], [ -121.435870488720624, 46.475912649814113 ], [ -121.423216489731146, 46.492691652052621 ], [ -121.380449478388883, 46.468127654992877 ], [ -121.358067473373382, 46.466948657600064 ], [ -121.318984465325343, 46.454726660532629 ], [ -121.265303459405089, 46.470142667751354 ], [ -121.272477462466682, 46.477104667320901 ], [ -121.254224462858929, 46.495837670133284 ], [ -121.209657459913615, 46.512480675631132 ], [ -121.186964452476928, 46.498786677023759 ], [ -121.1535664453789, 46.491556680453208 ], [ -121.126201437265806, 46.471033681709748 ], [ -121.123680431191431, 46.450245680546324 ], [ -121.096308430747541, 46.464097684956293 ], [ -121.023781418409598, 46.467316692908554 ], [ -120.970591415264565, 46.490013699109319 ], [ -120.95044241161601, 46.492302701509949 ], [ -120.905268410124393, 46.51654370783038 ], [ -120.873192406507499, 46.526727711593743 ], [ -120.850809401771087, 46.523081713662677 ], [ -120.775988391606106, 46.529868722550738 ], [ -120.715133380628544, 46.526707728491253 ], [ -120.660344372105214, 46.531288734266759 ], [ -120.570537361868972, 46.553352744813949 ], [ -120.506989351084826, 46.551053751859655 ], [ -120.471505340917616, 46.53492275433868 ], [ -120.476932338545922, 46.517390752899033 ], [ -120.459939335679309, 46.518190754553984 ], [ -120.450908330009099, 46.500190754230658 ], [ -120.411993318908216, 46.478905757579 ], [ -120.402548314354291, 46.466235757364856 ], [ -120.383830311732595, 46.464329758968887 ], [ -120.349114300297444, 46.443993761680794 ], [ -120.351415297241175, 46.427223759992486 ], [ -120.308866285287905, 46.403712763606933 ], [ -120.252429273375299, 46.394837768072911 ], [ -120.223107264120685, 46.376117769950632 ], [ -120.223881260586055, 46.355298768855889 ], [ -120.187916247745264, 46.327498770735659 ], [ -120.137140237036277, 46.315651775414914 ], [ -120.123560230795107, 46.298013775926499 ], [ -120.095783225156097, 46.29616877818443 ], [ -120.093980219893339, 46.270153777264838 ], [ -120.102040218379486, 46.257451775273125 ], [ -120.058793208763674, 46.245614779365184 ], [ -120.047777204205431, 46.233704779508983 ], [ -120.017093199299282, 46.237188783013551 ], [ -119.999522194918697, 46.230935784506066 ], [ -119.999978192515442, 46.214564783137263 ], [ -120.121331189005076, 46.10715376319785 ], [ -120.153184193703495, 46.102189759507702 ], [ -120.168472193724014, 46.086209757590836 ], [ -120.201822196692504, 46.076975753316965 ], [ -120.213466200517587, 46.084046752377361 ], [ -120.287052205188829, 46.048254743075013 ], [ -120.338341213119676, 46.042331737158968 ], [ -120.376178216756884, 46.028746732545791 ], [ -120.464558227674814, 46.010172722123443 ], [ -120.461981222997451, 45.993831720910194 ], [ -120.516185231217236, 45.986314714921797 ], [ -120.610828247782251, 45.995041705610944 ], [ -120.639271250641855, 45.982790701855123 ], [ -120.674726258717911, 45.994970699584954 ], [ -120.739125271779571, 46.004565693591232 ], [ -120.76501427520121, 46.001683690335675 ], [ -120.810594285126783, 46.010945686537823 ], [ -120.82337428334472, 45.994144684035433 ], [ -120.840340286875715, 45.997626682305068 ], [ -120.854384292351668, 46.014119682454009 ], [ -120.880545298718417, 46.018996680130449 ], [ -120.903098298654385, 46.004323676302683 ], [ -120.959338308368572, 46.004842670965758 ], [ -121.027047316733658, 45.992294663362053 ], [ -121.039331320428801, 45.996848661936191 ], [ -121.083062325527635, 45.990859657361234 ], [ -121.083062325527635, 45.990859657361234 ] ], [ [ -120.414726310011716, 46.434584753651968 ], [ -120.417406310712522, 46.43359175391528 ], [ -120.412125309316679, 46.433592754663231 ], [ -120.414726310011716, 46.434584753651968 ], [ -120.414726310011716, 46.434584753651968 ]
				]
			]
		}
	}
});	
		map.addLayer({
			'id': 'Yakama',
			'type': 'fill',
			'source': 'Yakama',
			'layout': {},
			'paint': {
				'fill-color': '#ffbf02',
				'fill-opacity': 0.15
				}

			});

	    {% for marker in markers %}
	    let marker{{ forloop.counter }} = new mapboxgl.Marker()
                .setLngLat([{{ marker.lon }}, {{ marker.lat }}])
      	    	{% if marker.loc_description %}

	    		.setPopup(new mapboxgl.Popup({
                		offset: 25,
                		closeOnClick: false
            			})
	    			.setHTML("{{ marker.loc_description }}"))
			    
		{% endif %}
			.addTo(map);
		{% if marker.loc_description %}
			marker{{ forloop.counter }}.togglePopup();
		{% endif %}
			
             
        
	{% endfor %}
        
        map.addControl(new mapboxgl.NavigationControl());
    })

</script>
{% endif %}
{% endblock %}
